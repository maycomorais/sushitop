<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel Administrativo - Sushi Top</title>
    
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <link rel="stylesheet" href="admin.css">
  </head>
  <body>
    
    <audio id="som-campainha" preload="auto" loop>
        <source src="https://www.soundjay.com/door/sounds/doorbell-1.mp3" type="audio/mpeg">
    </audio>

    <div class="sidebar">
      <div class="brand">SUSHI ADMIN</div>
      <div class="menu">
        <div class="menu-item active" onclick="showTab('dashboard', event)">
          <i class="fas fa-chart-line"></i><span class="mobile-hide"> Vis√£o</span>
        </div>
        <div class="menu-item" onclick="showTab('pedidos', event)">
          <i class="fas fa-clipboard-list"></i><span class="mobile-hide"> Pedidos</span>
        </div>
        <div class="menu-item" onclick="showTab('cozinha', event)">
          <i class="fas fa-fire"></i><span class="mobile-hide"> Cozinha</span>
        </div>
        <div class="menu-item" onclick="showTab('motoboys', event)">
          <i class="fas fa-motorcycle"></i><span class="mobile-hide"> Motos</span>
        </div>
        <div class="menu-item" onclick="showTab('financeiro', event)" id="menu-financeiro" style="display:none;">
            <i class="fas fa-wallet"></i><span class="mobile-hide"> Finan.</span>
        </div>
        <div class="menu-item" onclick="showTab('produtos', event)">
          <i class="fas fa-utensils"></i><span class="mobile-hide"> Prod.</span>
        </div>
        <div class="menu-item" onclick="showTab('categorias', event)">
          <i class="fas fa-tags"></i><span class="mobile-hide"> Cats</span>
        </div>
        <div class="menu-item" onclick="showTab('configuracoes', event)">
          <i class="fas fa-cog"></i><span class="mobile-hide"> Config</span>
        </div>
        <div class="menu-item" onclick="abrirModalBalcao()">
            <i class="fas fa-cash-register"></i><span class="mobile-hide"> Balc√£o</span>
        </div>
        <div class="menu-item" onclick="logout()" style="color: #e74c3c;">
          <i class="fas fa-sign-out-alt"></i><span class="mobile-hide"> Sair</span>
        </div>
      </div>
    </div>

    <div class="main-content">
      
      <div id="dashboard" class="tab-content active">
        <div class="header-title">
          <h2>Vis√£o Geral</h2>
          <small id="user-cargo" style="color:#888; font-weight:bold;">CARREGANDO...</small>
        </div>
        <div class="card-grid">
          <div class="kpi-card">
            <div class="kpi-title">Vendas Hoje</div>
            <div class="kpi-value kpi-green" id="kpi-vendas">Gs 0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-title">Pedidos Entregues</div>
            <div class="kpi-value" id="kpi-pedidos">0</div>
          </div>
          <div class="kpi-card">
            <div class="kpi-title">Custo Motoboy</div>
            <div class="kpi-value kpi-red" id="kpi-moto">Gs 0</div>
          </div>
        </div>
        <h3>üèÜ Ranking Produtos (Top 5)</h3>
        <div class="table-container">
          <table id="tabela-ranking">
            <thead>
              <tr><th>Produto</th><th>Vendas Totais</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div id="pedidos" class="tab-content">
        <div class="header-title">
          <h2>Gest√£o de Pedidos</h2>
          <button class="btn btn-primary" onclick="carregarPedidos()">
            <i class="fas fa-sync"></i> Atualizar
          </button>
        </div>

        <div style="background: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 10px; align-items: center; border: 1px solid #eee;">
          <strong><i class="fab fa-whatsapp"></i> Rota:</strong>
          <select id="sel-motoboy" class="form-control" style="width: auto; flex: 1">
            <option value="">Carregando...</option>
          </select>
          <button class="btn btn-success" onclick="enviarRotaZap()">Enviar</button>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th width="30"><input type="checkbox" onchange="toggleTodos(this)" /></th>
                <th>ID</th>
                <th>Cliente</th>
                <th>Status</th>
                <th>Valor</th>
                <th>A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="lista-pedidos"></tbody>
          </table>
        </div>
      </div>

      <div id="cozinha" class="tab-content">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
           <h2><i class="fas fa-fire" style="color:var(--primary)"></i> Fila de Produ√ß√£o</h2>
           <button onclick="carregarCozinha()" class="btn btn-info"><i class="fas fa-sync"></i> Atualizar</button>
        </div>
        <div id="grid-cozinha" style="display: flex; flex-direction: column; gap: 10px;"></div>
      </div>

      <div id="financeiro" class="tab-content">
        <h2>Financeiro do Dia</h2>
        <div class="finance-cards">
          <div class="card">
            <h3>Faturamento Total</h3>
            <div class="value" id="card-faturamento">Gs 0</div>
          </div>
          <div class="card">
            <h3>Custo Motoboys</h3>
            <div class="value" id="card-custo-moto">Gs 0</div>
          </div>
          <div class="card">
            <h3>Lucro L√≠quido</h3>
            <div class="value" id="card-lucro" style="color: green">Gs 0</div>
          </div>
        </div>

        <div class="finance-details" style="display: flex; gap: 20px; margin-top: 20px">
          <div class="card" style="flex: 1; background: #fff3cd; color: #856404">
            <h4>Pix / Transf.</h4>
            <div class="value" id="total-pix">Gs 0</div>
          </div>
          <div class="card" style="flex: 1; background: #d4edda; color: #155724">
            <h4>Efetivo</h4>
            <div class="value" id="total-efetivo">Gs 0</div>
          </div>
          <div class="card" style="flex: 1; background: #cce5ff; color: #004085">
            <h4>Cart√£o</h4>
            <div class="value" id="total-cartao">Gs 0</div>
          </div>
        </div>

        <h3 style="margin-top: 30px; border-bottom: 2px solid var(--primary); padding-bottom: 10px">
          <i class="fas fa-motorcycle"></i> Detalhamento por Motoboy
        </h3>
        <div class="table-container">
          <table>
            <thead style="background: var(--dark); color: white">
              <tr>
                <th>Motoboy</th>
                <th>Qtd</th>
                <th>Valor Unit.</th>
                <th style="text-align: right">Total</th>
              </tr>
            </thead>
            <tbody id="lista-financeiro-motoboys"></tbody>
          </table>
        </div>
      </div>

      <div id="produtos" class="tab-content">
        <div class="header-title">
          <h2>Produtos</h2>
          <button class="btn btn-primary" onclick="abrirModalProduto()">
            <i class="fas fa-plus"></i> Novo
          </button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Img</th><th>Nome</th><th>Cat</th><th>Pre√ßo</th><th>A√ß√µes</th></tr>
            </thead>
            <tbody id="lista-produtos"></tbody>
          </table>
        </div>
      </div>

      <div id="categorias" class="tab-content">
        <div class="header-title">
          <h2>Categorias</h2>
          <button class="btn btn-primary" onclick="abrirModalCategoria()">
            <i class="fas fa-plus"></i> Nova
          </button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Slug</th><th>Nome</th><th>Ordem</th><th>A√ß√µes</th></tr>
            </thead>
            <tbody id="lista-categorias"></tbody>
          </table>
        </div>
      </div>

      <div id="motoboys" class="tab-content">
        <div class="header-title">
          <h2>Motoboys</h2>
          <button class="btn btn-primary" onclick="abrirModalMoto()">
            <i class="fas fa-plus"></i> Novo
          </button>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr><th>Nome</th><th>Telefone</th><th>A√ß√µes</th></tr>
            </thead>
            <tbody id="lista-motos"></tbody>
          </table>
        </div>
      </div>

      <div id="configuracoes" class="tab-content">
        <h2>Configura√ß√µes da Loja</h2>
        <div style="display: flex; flex-wrap: wrap; gap: 20px">
          <div style="flex: 1; min-width: 300px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);">
            <h3>‚ö° Funcionamento</h3>
            <div class="form-group">
              <label>Loja Aberta?</label>
              <select id="cfg-aberta" class="form-control">
                <option value="true">SIM</option>
                <option value="false">N√ÉO</option>
              </select>
            </div>
            <div class="form-group">
              <label>Cota√ß√£o Real (R$)</label>
              <input type="number" id="cfg-cotacao" class="form-control" />
            </div>
            <div style="display: flex; gap: 10px">
              <div class="form-group" style="flex: 1">
                <label>Abre</label><input type="time" id="cfg-hora-abre" class="form-control" />
              </div>
              <div class="form-group" style="flex: 1">
                <label>Fecha</label><input type="time" id="cfg-hora-fecha" class="form-control" />
              </div>
            </div>
          </div>
          <div style="flex: 1; min-width: 300px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);">
            <h3>üì¢ Banner Promocional</h3>
            <div class="form-group">
              <label>ID do Produto</label>
              <input type="text" id="cfg-banner-id" class="form-control" placeholder="Ex: 15" />
            </div>
            <div class="form-group">
              <label>Imagem do Banner (URL)</label>
              <input type="text" id="cfg-banner-img" class="form-control" />
            </div>
            <div style="text-align: center; margin-top: 10px">
              <img id="preview-banner" src="" style="max-width: 100%; height: 100px; object-fit: cover; border-radius: 8px; display: none;" />
            </div>
          </div>
        </div>
        <button class="btn btn-success" style="margin-top: 20px; width: 100%; padding: 15px" onclick="salvarConfiguracoes()">SALVAR TUDO</button>
      </div>

    </div> <div id="modal-produto" class="modal-overlay">
      <div class="modal-box">
        <span class="close-modal" onclick="fecharModal('modal-produto')">&times;</span>
        <h3>Produto</h3>
        <input type="hidden" id="prod-id" />
        <div class="form-group"><label>Nome</label><input type="text" id="prod-nome" class="form-control" /></div>
        <div class="form-group"><label>Descri√ß√£o</label><input type="text" id="prod-desc" class="form-control" /></div>
        <div style="display: flex; gap: 10px">
          <div class="form-group" style="flex: 1"><label>Pre√ßo</label><input type="number" id="prod-preco" class="form-control" /></div>
          <div class="form-group" style="flex: 1"><label>Categoria</label><select id="prod-cat" class="form-control"></select></div>
        </div>
        <div class="form-group">
           <label>Imagem (URL ou Upload)</label>
           <input type="text" id="prod-img" class="form-control" placeholder="Link da imagem..." style="margin-bottom:5px;">
           <input type="file" id="prod-img-file" accept="image/*" class="form-control" onchange="previewUpload(this)">
           <div id="box-preview" style="display:none; text-align:center; margin-top:10px;">
               <img id="img-preview" src="" style="height:80px; border-radius:5px;">
           </div>
        </div>
        <div class="form-group" style="background: #f0faff; padding: 10px; border-radius: 5px">
           <label style="display:flex; align-items:center; gap:5px;"><input type="checkbox" id="prod-montavel" onchange="toggleBuilder()"> Produto Mont√°vel?</label>
           <div id="builder-area" class="builder-box" style="display: none">
              <div id="builder-steps"></div>
              <button class="btn btn-sm btn-primary" style="margin-top: 10px" onclick="addBuilderStep()">+ Etapa</button>
           </div>
        </div>
        <div class="modal-actions">
           <button class="btn btn-danger" onclick="fecharModal('modal-produto')">Cancelar</button>
           <button class="btn btn-success" onclick="salvarProduto()">Salvar</button>
        </div>
      </div>
    </div>

    <div id="modal-cat" class="modal-overlay">
      <div class="modal-box">
        <span class="close-modal" onclick="fecharModal('modal-cat')">&times;</span>
        <h3 id="titulo-modal-cat">Nova Categoria</h3>
        <input type="hidden" id="cat-modo-edicao" value="nao" />
        <div class="form-group"><label>Slug (ID)</label><input type="text" id="cat-slug" class="form-control" /></div>
        <div class="form-group"><label>Nome Exibi√ß√£o</label><input type="text" id="cat-nome" class="form-control" /></div>
        <div class="form-group"><label>Ordem</label><input type="number" id="cat-ordem" class="form-control" /></div>
        <div class="modal-actions"><button class="btn btn-success" onclick="salvarCategoria()">Salvar</button></div>
      </div>
    </div>

    <div id="modal-moto" class="modal-overlay">
      <div class="modal-box">
        <span class="close-modal" onclick="fecharModal('modal-moto')">&times;</span>
        <h3>Motoboy</h3>
        <input type="hidden" id="moto-id" />
        <div class="form-group"><label>Nome</label><input type="text" id="moto-nome" class="form-control" /></div>
        <div class="form-group"><label>Telefone</label><input type="text" id="moto-tel" class="form-control" /></div>
        <div class="modal-actions"><button class="btn btn-success" onclick="salvarMotoboy()">Salvar</button></div>
      </div>
    </div>

    <div id="modal-balcao" class="modal-overlay">
      <div class="modal-box">
        <span class="close-modal" onclick="fecharModal('modal-balcao')">&times;</span>
        <h3>üè™ Venda Balc√£o</h3>
        <div class="form-group"><label>Cliente</label><input type="text" id="balcao-cliente" class="form-control" placeholder="Nome" /></div>
        <div class="form-group"><label>Buscar Item</label><input list="lista-sugestoes" id="balcao-busca" class="form-control" onchange="adicionarItemBalcao()" /><datalist id="lista-sugestoes"></datalist></div>
        <div style="max-height: 150px; overflow-y: auto; border: 1px solid #eee; margin-bottom: 10px"><table style="font-size: 0.9rem"><tbody id="lista-itens-balcao"></tbody></table></div>
        <div style="text-align: right; font-weight: bold; font-size: 1.2rem; margin-bottom: 10px">Total: Gs <span id="balcao-total">0</span></div>
        <div class="form-group">
            <label>Pagamento</label>
            <select id="balcao-pag" class="form-control">
                <option value="Efetivo">Efetivo</option>
                <option value="Cartao">Cart√£o</option>
                <option value="Pix">Pix</option>
                <option value="Transferencia">Transfer√™ncia</option>
            </select>
        </div>
        <div class="modal-actions"><button class="btn btn-success" style="width: 100%" onclick="salvarPedidoBalcao()">FINALIZAR VENDA</button></div>
      </div>
    </div>

    <script src="supabaseClient.js"></script>
    <script src="admin.js"></script>
  </body>
</html>